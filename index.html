<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RLCç”µè·¯ SåŸŸå…¨èƒ½ä»¿çœŸå®éªŒå®¤</title>
    
    <!-- å¼•å…¥ Chart.js ç”¨äºç»˜å›¾ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- å¼•å…¥ KaTeX ç”¨äºæ¸²æŸ“ä¸“ä¸šæ•°å­¦å…¬å¼ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"></script>
    <!-- å¼•å…¥ TailwindCSS ç”¨äºå¸ƒå±€ -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { background-color: #f8fafc; font-family: 'Segoe UI', sans-serif; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); padding: 1.5rem; }
        .slider-container { display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem; }
        .slider-label { min-width: 4rem; font-weight: 600; color: #475569; }
        input[type="range"] { flex-grow: 1; height: 6px; border-radius: 3px; background: #cbd5e1; outline: none; }
        .math-display { overflow-x: auto; padding: 0.5rem 0; min-height: 3rem; }
        canvas { width: 100% !important; height: 100% !important; }
    </style>
</head>
<body class="p-4 md:p-6 lg:p-8 max-w-[1600px] mx-auto">

    <!-- Header -->
    <header class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center border-b border-gray-200 pb-4">
        <div>
            <h1 class="text-3xl font-bold text-slate-800">âš¡ RLCç”µè·¯ SåŸŸå…¨èƒ½ä»¿çœŸå®éªŒå®¤</h1>
            <p class="text-slate-500 mt-1">ä¸²è” RLC ç”µè·¯ï¼šä»å‚æ•°åˆ°å“åº”çš„å®Œæ•´æ˜ å°„</p>
        </div>
        <div class="mt-4 md:mt-0 px-4 py-2 bg-blue-50 text-blue-700 rounded-lg text-sm font-medium">
            çŠ¶æ€ï¼š<span id="systemStatus">æ­£åœ¨åˆå§‹åŒ–...</span>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <!-- å·¦ä¾§ï¼šå‚æ•°æ§åˆ¶ä¸å…¬å¼ (å  4 åˆ—) -->
        <div class="lg:col-span-4 space-y-6">
            
            <!-- ç”µè·¯å‚æ•°æ§åˆ¶ -->
            <div class="card border-l-4 border-blue-500">
                <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                    <span>ğŸ›ï¸ ç”µè·¯å‚æ•°</span>
                </h2>
                
                <div class="space-y-4">
                    <div class="slider-container">
                        <span class="slider-label">R (Î©)</span>
                        <input type="range" id="sliderR" min="0" max="20" step="0.1" value="2">
                        <span id="valR" class="w-16 text-right font-mono text-blue-600">2.0</span>
                    </div>
                    <div class="slider-container">
                        <span class="slider-label">L (H)</span>
                        <input type="range" id="sliderL" min="0.1" max="5" step="0.1" value="1">
                        <span id="valL" class="w-16 text-right font-mono text-blue-600">1.0</span>
                    </div>
                    <div class="slider-container">
                        <span class="slider-label">C (F)</span>
                        <input type="range" id="sliderC" min="0.1" max="5" step="0.1" value="1">
                        <span id="valC" class="w-16 text-right font-mono text-blue-600">1.0</span>
                    </div>
                </div>

                <div class="mt-6 pt-4 border-t border-gray-100">
                    <div class="text-sm text-gray-500 mb-2">äºŒé˜¶ç³»ç»Ÿå‚æ•°ï¼š</div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-slate-50 p-2 rounded">
                            <div class="text-xs text-slate-400">è‡ªç„¶é¢‘ç‡ Ï‰n</div>
                            <div id="valWn" class="font-bold text-slate-700">1.00 rad/s</div>
                        </div>
                        <div class="bg-slate-50 p-2 rounded">
                            <div class="text-xs text-slate-400">é˜»å°¼æ¯” Î¶</div>
                            <div id="valZeta" class="font-bold text-slate-700">0.50</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ•°å­¦æ¨¡å‹æ˜¾ç¤º -->
            <div class="card bg-slate-800 text-white border-none">
                <h2 class="text-lg font-bold text-slate-200 mb-2">ğŸ“ æ•°å­¦æ¨¡å‹</h2>
                
                <div class="space-y-4">
                    <div>
                        <div class="text-xs text-slate-400 mb-1">ä¼ é€’å‡½æ•° H(s) = Vc(s)/Vi(s)</div>
                        <div id="mathTransfer" class="math-display"></div>
                    </div>
                    <div>
                        <div class="text-xs text-slate-400 mb-1">ç‰¹å¾æ–¹ç¨‹ (Characteristic Eq)</div>
                        <div id="mathCharEq" class="math-display"></div>
                    </div>
                    <div>
                        <div class="text-xs text-slate-400 mb-1">æç‚¹ s1, s2</div>
                        <div id="mathPoles" class="math-display text-yellow-300"></div>
                    </div>
                </div>
            </div>

            <div class="card bg-yellow-50 border-yellow-200">
                <h3 class="font-bold text-yellow-800 text-sm mb-1">ğŸ’¡ çŸ¥è¯†ç‚¹æ‰©å±•</h3>
                <p class="text-xs text-yellow-700 leading-relaxed">
                    è°ƒæ•´ <b>R</b> å®é™…ä¸Šæ˜¯åœ¨æ”¹å˜ç³»ç»Ÿçš„<b>é˜»å°¼(Damping)</b>ã€‚<br>
                    â€¢ R = 0: æ— é˜»å°¼æŒ¯è¡ (è™šè½´æç‚¹)<br>
                    â€¢ å° R: æ¬ é˜»å°¼ (å…±è½­å¤æç‚¹, æŒ¯è¡è¡°å‡)<br>
                    â€¢ å¤§ R: è¿‡é˜»å°¼ (å®è½´åˆ†ç¦»æç‚¹, æ— æŒ¯è¡)
                </p>
            </div>
        </div>

        <!-- ä¸­é—´ï¼šSå¹³é¢ä¸å›¾å½¢ (å  8 åˆ—) -->
        <div class="lg:col-span-8 space-y-6">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 h-[400px]">
                <!-- Så¹³é¢ -->
                <div class="card flex flex-col relative overflow-hidden">
                    <h2 class="text-lg font-bold text-slate-700 absolute top-4 left-4 z-10">ğŸ“ S å¹³é¢ (æç‚¹åˆ†å¸ƒ)</h2>
                    <div class="flex-grow relative mt-6">
                        <canvas id="canvasSPlane"></canvas>
                        <div class="absolute bottom-0 right-0 text-xs text-gray-400 bg-white/80 p-1 pointer-events-none">
                            Xè½´: Ïƒ (è¡°å‡)<br>Yè½´: jÏ‰ (é¢‘ç‡)
                        </div>
                    </div>
                </div>

                <!-- æ—¶åŸŸå“åº” -->
                <div class="card flex flex-col relative">
                    <h2 class="text-lg font-bold text-slate-700 absolute top-4 left-4 z-10">ğŸ“ˆ æ—¶åŸŸé˜¶è·ƒå“åº” v_c(t)</h2>
                    <div class="flex-grow relative mt-6">
                        <canvas id="chartTime"></canvas>
                    </div>
                </div>
            </div>

            <!-- é¢‘åŸŸå“åº” (Bode Plot) -->
            <div class="card h-[300px] flex flex-col relative">
                <h2 class="text-lg font-bold text-slate-700 absolute top-4 left-4 z-10">ğŸ”Š é¢‘åŸŸå“åº” (å¹…é¢‘ç‰¹æ€§ |H(jÏ‰)|)</h2>
                <div class="flex-grow relative mt-6">
                    <canvas id="chartBode"></canvas>
                </div>
            </div>

        </div>
    </div>

    <script>
        // === å…¨å±€å˜é‡ ===
        const config = {
            R: 2, L: 1, C: 1
        };
        
        let chartTime, chartBode;
        let sCtx;
        
        // === åˆå§‹åŒ– ===
        window.onload = function() {
            initCharts();
            initSPlaneCanvas();
            updateAll();
            
            // ç»‘å®šæ»‘å—äº‹ä»¶
            ['R', 'L', 'C'].forEach(param => {
                const el = document.getElementById('slider' + param);
                el.addEventListener('input', (e) => {
                    config[param] = parseFloat(e.target.value);
                    document.getElementById('val' + param).innerText = config[param].toFixed(1);
                    updateAll();
                });
            });
        };

        // === æ ¸å¿ƒè®¡ç®—é€»è¾‘ ===
        function calculateSystem() {
            const { R, L, C } = config;
            
            // äºŒé˜¶ç³»ç»Ÿæ ‡å‡†å‚æ•°
            // H(s) = wn^2 / (s^2 + 2*zeta*wn*s + wn^2)
            const wn = 1 / Math.sqrt(L * C);
            const zeta = (R / 2) * Math.sqrt(C / L);
            
            // æç‚¹è®¡ç®—
            // s^2 + (R/L)s + 1/LC = 0
            const alpha = R / (2 * L); // å®éƒ¨è¡°å‡å› å­ sigma
            const delta = alpha * alpha - wn * wn; // åˆ¤åˆ«å¼
            
            let p1, p2, type;
            
            if (Math.abs(delta) < 0.0001) {
                // ä¸´ç•Œé˜»å°¼
                type = 'critical';
                p1 = { re: -alpha, im: 0 };
                p2 = { re: -alpha, im: 0 };
            } else if (delta > 0) {
                // è¿‡é˜»å°¼ (ä¸¤ä¸ªå®æ ¹)
                type = 'over';
                p1 = { re: -alpha + Math.sqrt(delta), im: 0 };
                p2 = { re: -alpha - Math.sqrt(delta), im: 0 };
            } else {
                // æ¬ é˜»å°¼ (å…±è½­å¤æ ¹)
                type = 'under';
                p1 = { re: -alpha, im: Math.sqrt(-delta) };
                p2 = { re: -alpha, im: -Math.sqrt(-delta) };
            }

            return { wn, zeta, alpha, p1, p2, type };
        }

        // === æ›´æ–°æ‰€æœ‰è§†å›¾ ===
        function updateAll() {
            const sys = calculateSystem();
            
            updateStatus(sys);
            renderMath(sys);
            drawSPlane(sys);
            updateTimeChart(sys);
            updateBodeChart(sys);
        }

        function updateStatus(sys) {
            const el = document.getElementById('systemStatus');
            const wnEl = document.getElementById('valWn');
            const zetaEl = document.getElementById('valZeta');
            
            wnEl.innerText = sys.wn.toFixed(2) + " rad/s";
            zetaEl.innerText = sys.zeta.toFixed(2);
            
            let statusText = "";
            let colorClass = "";
            
            if (sys.type === 'under') {
                statusText = "æ¬ é˜»å°¼ (æŒ¯è¡æ”¶æ•›)";
                colorClass = "text-purple-600";
            } else if (sys.type === 'over') {
                statusText = "è¿‡é˜»å°¼ (æ— æŒ¯è¡æ…¢æ”¶æ•›)";
                colorClass = "text-orange-600";
            } else {
                statusText = "ä¸´ç•Œé˜»å°¼ (æœ€å¿«æ— è¶…è°ƒ)";
                colorClass = "text-green-600";
            }
            
            // å¦‚æœç”µé˜»ä¸º0 (ç‰¹æ®Šå¤„ç†)
            if(config.R == 0) {
                statusText = "æ— é˜»å°¼ (ç­‰å¹…æŒ¯è¡)";
                colorClass = "text-red-600";
            }

            el.innerHTML = `<span class="${colorClass} font-bold">${statusText}</span>`;
        }

        // === KaTeX æ•°å­¦å…¬å¼æ¸²æŸ“ ===
        function renderMath(sys) {
            const { R, L, C } = config;
            
            // ä¼ é€’å‡½æ•°å…¬å¼
            // H(s) = (1/LC) / (s^2 + R/L s + 1/LC)
            const num = (1/(L*C)).toFixed(1);
            const coefS = (R/L).toFixed(1);
            const den = `s^2 + ${coefS}s + ${num}`;
            const texTransfer = `H(s) = \\frac{${num}}{${den}}`;
            
            katex.render(texTransfer, document.getElementById('mathTransfer'), { throwOnError: false });

            // ç‰¹å¾æ–¹ç¨‹
            const texChar = `L s^2 + R s + \\frac{1}{C} = 0`;
            katex.render(texChar, document.getElementById('mathCharEq'), { throwOnError: false });

            // æç‚¹
            let texPoles = "";
            if (sys.type === 'under') {
                texPoles = `s_{1,2} = ${sys.p1.re.toFixed(2)} \\pm j${Math.abs(sys.p1.im).toFixed(2)}`;
            } else {
                texPoles = `s_1 = ${sys.p1.re.toFixed(2)}, \\quad s_2 = ${sys.p2.re.toFixed(2)}`;
            }
            katex.render(texPoles, document.getElementById('mathPoles'), { throwOnError: false });
        }

        // === ç»˜å›¾é€»è¾‘: Så¹³é¢ ===
        function initSPlaneCanvas() {
            const canvas = document.getElementById('canvasSPlane');
            // é€‚é…é«˜æ¸…å±
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            sCtx = canvas.getContext('2d');
            sCtx.scale(dpr, dpr);
        }

        function drawSPlane(sys) {
            const canvas = document.getElementById('canvasSPlane');
            const width = canvas.width / (window.devicePixelRatio || 1);
            const height = canvas.height / (window.devicePixelRatio || 1);
            const ctx = sCtx;

            ctx.clearRect(0, 0, width, height);

            // åæ ‡ç³»è®¾ç½®
            const originX = width * 0.8; // åŸç‚¹åå³ï¼Œå› ä¸ºæç‚¹é€šå¸¸åœ¨å·¦åŠå¹³é¢
            const originY = height / 2;
            const scale = 40; // ç¼©æ”¾æ¯”ä¾‹

            // ç”»ç½‘æ ¼
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            // å‚ç›´çº¿
            for (let x = originX; x > 0; x -= scale) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, height); ctx.stroke(); }
            // æ°´å¹³çº¿
            for (let y = originY; y < height; y += scale) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(width, y); ctx.stroke(); }
            for (let y = originY; y > 0; y -= scale) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(width, y); ctx.stroke(); }

            // ç”»åæ ‡è½´
            ctx.strokeStyle = '#64748b';
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(0, originY); ctx.lineTo(width, originY); ctx.stroke(); // å®è½´
            ctx.beginPath(); ctx.moveTo(originX, 0); ctx.lineTo(originX, height); ctx.stroke(); // è™šè½´

            // ç”»æç‚¹ (X)
            function drawPole(re, im) {
                const x = originX + re * scale;
                const y = originY - im * scale; // Canvas Yè½´å‘ä¸‹
                const size = 6;
                
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(x - size, y - size); ctx.lineTo(x + size, y + size);
                ctx.moveTo(x + size, y - size); ctx.lineTo(x - size, y + size);
                ctx.stroke();

                // è™šçº¿è¿æ¥åˆ°è½´
                ctx.setLineDash([4, 4]);
                ctx.strokeStyle = '#94a3b8';
                ctx.lineWidth = 1;
                ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x, originY); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(originX, y); ctx.stroke();
                ctx.setLineDash([]);
            }

            drawPole(sys.p1.re, sys.p1.im);
            if (sys.p1.im !== 0 || sys.p1.re !== sys.p2.re) {
                drawPole(sys.p2.re, sys.p2.im);
            }
        }

        // === ç»˜å›¾é€»è¾‘: Chart.js ===
        function initCharts() {
            // æ—¶åŸŸå›¾
            const ctxTime = document.getElementById('chartTime').getContext('2d');
            chartTime = new Chart(ctxTime, {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'ç”µå‹ vc(t)', data: [], borderColor: '#3b82f6', borderWidth: 2, pointRadius: 0, tension: 0.4 }] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    scales: {
                        x: { type: 'linear', position: 'bottom', title: { display: true, text: 'æ—¶é—´ (s)' }, max: 10 },
                        y: { title: { display: true, text: 'å¹…å€¼ (V)' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // é¢‘åŸŸå›¾
            const ctxBode = document.getElementById('chartBode').getContext('2d');
            chartBode = new Chart(ctxBode, {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'å¹…å€¼ |H(jw)|', data: [], borderColor: '#10b981', borderWidth: 2, pointRadius: 0, fill: true, backgroundColor: 'rgba(16, 185, 129, 0.1)' }] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    scales: {
                        x: { type: 'logarithmic', title: { display: true, text: 'é¢‘ç‡ Ï‰ (rad/s)' }, min: 0.1, max: 100 },
                        y: { title: { display: true, text: 'å¢ç›Š' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function updateTimeChart(sys) {
            const data = [];
            const dt = 0.05;
            const maxT = 15; // æ˜¾ç¤º15ç§’
            
            for (let t = 0; t <= maxT; t += dt) {
                let y = 0;
                // é˜¶è·ƒå“åº”è®¡ç®— (Step Response)
                // H(s) * 1/s çš„é€†å˜æ¢
                if (sys.type === 'under') {
                    // æ¬ é˜»å°¼: 1 - e^(-at)/sqrt(1-z^2) * sin(wd*t + phi)
                    const wd = Math.abs(sys.p1.im);
                    const phi = Math.atan(wd / sys.alpha); // æˆ–è€… acos(zeta)
                    y = 1 - (Math.exp(-sys.alpha * t) / Math.sqrt(1 - sys.zeta*sys.zeta)) * Math.sin(wd * t + Math.acos(sys.zeta));
                } else if (sys.type === 'critical') {
                    // ä¸´ç•Œ: 1 - e^(-wnt)(1 + wnt)
                    y = 1 - Math.exp(-sys.wn * t) * (1 + sys.wn * t);
                } else {
                    // è¿‡é˜»å°¼: 1 + c1*e^(s1t) + c2*e^(s2t)
                    const s1 = sys.p1.re;
                    const s2 = sys.p2.re;
                    y = 1 + (s2 * Math.exp(s1 * t) - s1 * Math.exp(s2 * t)) / (s1 - s2); // ç®€åŒ–åçš„ç³»æ•°æ¨å¯¼
                }
                data.push({ x: t, y: y });
            }
            
            chartTime.data.datasets[0].data = data;
            chartTime.options.scales.x.max = maxT;
            chartTime.update();
        }

        function updateBodeChart(sys) {
            const data = [];
            // å¯¹æ•°åæ ‡ç”Ÿæˆç‚¹
            for (let w = 0.1; w <= 100; w *= 1.1) {
                // H(jw) = wn^2 / ((jw)^2 + 2*zeta*wn*jw + wn^2)
                // |H(jw)| = wn^2 / sqrt( (wn^2 - w^2)^2 + (2*zeta*wn*w)^2 )
                const num = sys.wn * sys.wn;
                const re = sys.wn * sys.wn - w * w;
                const im = 2 * sys.zeta * sys.wn * w;
                const mag = num / Math.sqrt(re * re + im * im);
                
                data.push({ x: w, y: mag });
            }
            
            chartBode.data.datasets[0].data = data;
            chartBode.update();
        }

    </script>
</body>
</html>
